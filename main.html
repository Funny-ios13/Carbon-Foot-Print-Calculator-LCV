<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Huella de Carbono</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom Styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f9ff; /* Light blue background */
        }
        .calculator-container {
            background-color: white;
            border-radius: 1rem; /* More rounded corners */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            padding: 2rem;
            margin-top: 2rem;
            margin-bottom: 2rem;
            max-width: 700px; /* Limit max width */
            margin-left: auto;
            margin-right: auto;
        }
        .question-card {
            border: 1px solid #e5e7eb; /* Light gray border */
            border-radius: 0.75rem; /* Rounded corners */
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            background-color: #f9fafb; /* Very light gray background */
        }
        .option-label {
            display: block;
            padding: 0.75rem 1.25rem;
            margin-bottom: 0.5rem;
            border: 1px solid #d1d5db; /* Gray border */
            border-radius: 0.5rem; /* Rounded corners */
            cursor: pointer;
            transition: background-color 0.2s ease, border-color 0.2s ease;
            background-color: white;
        }
        .option-label:hover {
            background-color: #f3f4f6; /* Lighter gray on hover */
        }
        input[type="radio"]:checked + .option-label {
            background-color: #bfdbfe; /* Light blue when selected */
            border-color: #3b82f6; /* Blue border when selected */
            font-weight: 500;
        }
        input[type="radio"] {
            display: none; /* Hide the actual radio button */
        }
        .nav-button {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: background-color 0.2s ease;
            cursor: pointer;
        }
        .nav-button-primary {
            background-color: #3b82f6; /* Blue */
            color: white;
        }
        .nav-button-primary:hover {
            background-color: #2563eb; /* Darker blue */
        }
         .nav-button-primary:disabled {
            background-color: #9ca3af; /* Gray when disabled */
            cursor: not-allowed;
        }
        .nav-button-secondary {
            background-color: #e5e7eb; /* Light gray */
            color: #374151; /* Dark gray text */
        }
        .nav-button-secondary:hover {
            background-color: #d1d5db; /* Gray */
        }
        .result-section {
            background-color: #ecfdf5; /* Light green background */
            border: 1px solid #a7f3d0; /* Green border */
            border-radius: 0.75rem;
            padding: 1.5rem;
            text-align: center;
        }
        .language-selector select {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            border: 1px solid #d1d5db;
        }
        /* Hide elements */
        .hidden {
            display: none;
        }
         /* Progress Bar */
        .progress-bar-container {
            width: 100%;
            background-color: #e5e7eb; /* Light gray background */
            border-radius: 0.5rem;
            margin-bottom: 1.5rem;
            overflow: hidden; /* Ensure inner bar respects border radius */
        }
        .progress-bar {
            height: 10px;
            background-color: #3b82f6; /* Blue */
            width: 0%; /* Initial width */
            border-radius: 0.5rem;
            transition: width 0.3s ease-in-out;
        }
         /* Logo Style */
        .header-logo {
             width: 50px; /* Adjust size as needed */
             height: 50px;
             margin-right: 1rem; /* Space between logo and title */
        }
         /* Footer Style */
        .footer-text {
            font-size: 0.8rem; /* Smaller text */
            color: #6b7280; /* Gray text */
            text-align: center;
            margin-top: 2rem; /* Space above footer */
            border-top: 1px solid #e5e7eb; /* Separator line */
            padding-top: 1rem; /* Space below separator */
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="calculator-container">

        <div class="flex justify-between items-start mb-6">
             <div class="flex items-center">
                 <img src="logo-del-colegio.png" alt="Logo del Proyecto" class="header-logo rounded-full" onerror="this.style.display='none'"> <div>
                     <h1 class="text-2xl md:text-3xl font-bold text-gray-800" data-translate="title">Calculadora de Huella de Carbono</h1>
                     <p class="text-gray-600" data-translate="subtitle">Descubre tu impacto ambiental respondiendo unas simples preguntas.</p>
                 </div>
             </div>
             <div class="language-selector text-right flex-shrink-0 ml-4">
                 <label for="lang-select" class="sr-only" data-translate="selectLanguage">Selecciona Idioma:</label>
                 <select id="lang-select" class="text-sm mt-1">
                     <option value="es">Español</option>
                     <option value="en">English</option>
                     <option value="fr">Français</option>
                 </select>
             </div>
        </div>

        <div class="progress-bar-container">
            <div id="progress-bar" class="progress-bar"></div>
        </div>
        <p class="text-center text-sm text-gray-500 mb-8" id="progress-text"><span data-translate="question">Pregunta</span> 1 / 14</p>

        <form id="carbon-form">
            <div id="questions-container">
                </div>

            <div id="navigation" class="flex justify-between mt-8 hidden">
                <button type="button" id="prev-btn" class="nav-button nav-button-secondary" data-translate="prevButton">Anterior</button>
                <button type="button" id="next-btn" class="nav-button nav-button-primary" data-translate="nextButton">Siguiente</button>
                <button type="submit" id="submit-btn" class="nav-button nav-button-primary hidden" data-translate="submitButton" disabled>Calcular Huella</button>
            </div>
        </form>

        <div id="result" class="result-section mt-8 hidden">
            <h2 class="text-xl font-semibold mb-3 text-green-800" data-translate="resultTitle">Tu Huella de Carbono Estimada</h2>
            <p class="text-3xl font-bold mb-4 text-green-700"><span id="score">0</span> <span data-translate="resultUnit">toneladas de CO2e/año</span></p>
            <p class="text-gray-700 mb-4" id="result-message" data-translate="resultInfoDefault">Completa el cuestionario para ver tu resultado.</p>
            <h3 class="text-lg font-semibold mt-6 mb-2 text-green-800" data-translate="tipsTitle">Consejos para Reducir tu Huella:</h3>
            <ul id="tips-list" class="list-disc list-inside text-left text-gray-700 space-y-1">
                </ul>
             <button type="button" id="restart-btn" class="nav-button nav-button-primary mt-6" data-translate="restartButton">Empezar de Nuevo</button>
        </div>

        <footer class="mt-12 pt-6 border-t border-gray-200">
             <p class="text-xs text-gray-500 text-center" data-translate="footer_text">
                 Hecho por Luis Marcelo Medina para un proyecto escolar de Liceo Campo Verde
             </p>
        </footer>
        </div> <script>
        // --- Translations ---
        const translations = {
            es: {
                selectLanguage: "Selecciona Idioma:",
                title: "Calculadora de Huella de Carbono",
                subtitle: "Descubre tu impacto ambiental respondiendo unas simples preguntas.",
                prevButton: "Anterior",
                nextButton: "Siguiente",
                submitButton: "Calcular Huella",
                resultTitle: "Tu Huella de Carbono Estimada",
                resultUnit: "toneladas de CO2e/año",
                resultInfoDefault: "Completa el cuestionario para ver tu resultado.",
                tipsTitle: "Consejos para Reducir tu Huella:",
                restartButton: "Empezar de Nuevo",
                question: "Pregunta",
                footer_text: "Hecho por Luis Marcelo Medina para un proyecto escolar de Liceo Campo Verde", // Added footer text ES
                // Questions & Options (Q1-Q14) ... [Kept for brevity, same as previous version]
                q1_title: "Pregunta 1: Dieta - Carne Roja",
                q1_text: "¿Con qué frecuencia consumes carne roja (res, cerdo, cordero)?",
                q1_opt1: "Casi todos los días", q1_opt2: "Varias veces por semana", q1_opt3: "Rara vez o nunca",
                q2_title: "Pregunta 2: Transporte Principal",
                q2_text: "¿Cuál es tu medio de transporte principal para distancias largas (>15km)?",
                q2_opt1: "Coche (gasolina/diésel)", q2_opt2: "Transporte público (bus/tren/metro)", q2_opt3: "Coche eléctrico/híbrido", q2_opt4: "Bicicleta/Caminar/Ninguno",
                q3_title: "Pregunta 3: Energía en Casa",
                q3_text: "¿Qué tan eficiente es el uso de energía en tu hogar?",
                q3_opt1: "Poco eficiente (electrodomésticos viejos, sin aislamiento)", q3_opt2: "Moderadamente eficiente", q3_opt3: "Muy eficiente (LEDs, aislamiento, renovables)",
                q4_title: "Pregunta 4: Consumo y Residuos",
                q4_text: "¿Compras artículos nuevos (ropa, electrónicos) y reciclas?",
                q4_opt1: "Compro a menudo, reciclo poco", q4_opt2: "Compro ocasionalmente, reciclo regularmente", q4_opt3: "Compro raramente (prefiero usado), reciclo mucho",
                q5_title: "Pregunta 5: Viajes Aéreos (Cortos)",
                q5_text: "¿Cuántos vuelos cortos (menos de 3 horas) realizas al año?",
                q5_opt1: "Ninguno", q5_opt2: "1-2 vuelos", q5_opt3: "3-5 vuelos", q5_opt4: "Más de 5 vuelos",
                q6_title: "Pregunta 6: Viajes Aéreos (Largos)",
                q6_text: "¿Cuántos vuelos largos (más de 3 horas) realizas al año?",
                q6_opt1: "Ninguno", q6_opt2: "1-2 vuelos", q6_opt3: "3-4 vuelos", q6_opt4: "Más de 4 vuelos",
                q7_title: "Pregunta 7: Tamaño del Hogar",
                q7_text: "¿Cuántas personas viven en tu hogar (incluyéndote)?",
                q7_opt1: "Vivo solo/a", q7_opt2: "2 personas", q7_opt3: "3-4 personas", q7_opt4: "5 o más personas",
                q8_title: "Pregunta 8: Tipo de Vivienda",
                q8_text: "¿En qué tipo de vivienda resides principalmente?",
                q8_opt1: "Casa grande independiente", q8_opt2: "Casa adosada / Dúplex", q8_opt3: "Apartamento / Piso",
                q9_title: "Pregunta 9: Fuente de Energía Principal",
                q9_text: "¿Cuál es la fuente principal de energía para calefacción/cocina en tu hogar?",
                q9_opt1: "Carbón / Leña / Gasóleo", q9_opt2: "Gas natural / GLP", q9_opt3: "Electricidad (mix de red estándar)", q9_opt4: "Electricidad (fuentes renovables certificadas) / Sin calefacción",
                q10_title: "Pregunta 10: Residuos Orgánicos",
                q10_text: "¿Qué haces con tus residuos orgánicos (restos de comida)?",
                q10_opt1: "Van a la basura normal", q10_opt2: "Compostaje casero / Recogida selectiva municipal", q10_opt3: "No genero casi residuos orgánicos",
                q11_title: "Pregunta 11: Consumo de Agua",
                q11_text: "¿Eres consciente de tu consumo de agua y tomas medidas para reducirlo?",
                q11_opt1: "No mucho, uso agua sin restricciones", q11_opt2: "A veces, cierro grifos pero no mucho más", q11_opt3: "Sí, activamente (duchas cortas, reutilización, etc.)",
                q12_title: "Pregunta 12: Transporte Secundario",
                q12_text: "¿Utilizas coche (propio o compartido) para trayectos cortos (<5km) regularmente?",
                q12_opt1: "Sí, casi siempre", q12_opt2: "A veces, si es necesario", q12_opt3: "No, prefiero caminar, bici o transporte público",
                q13_title: "Pregunta 13: Compra Local y de Temporada",
                q13_text: "¿Con qué frecuencia compras alimentos locales y de temporada?",
                q13_opt1: "Rara vez, compro lo que encuentro", q13_opt2: "Ocasionalmente, si está disponible", q13_opt3: "Frecuentemente, busco activamente productos locales",
                q14_title: "Pregunta 14: Dieta - Lácteos y Pollo",
                q14_text: "¿Cuál es tu consumo de lácteos (leche, queso, yogur) y pollo/aves?",
                q14_opt1: "Alto consumo diario", q14_opt2: "Consumo moderado (varias veces por semana)", q14_opt3: "Bajo consumo o nulo",
                // Result Messages & Tips ... [Kept for brevity]
                result_low: "Tu huella es relativamente baja. ¡Excelente trabajo! Sigue así y comparte tus hábitos.",
                result_medium: "Tu huella está en un rango promedio. Hay varias oportunidades claras para mejorar.",
                result_high: "Tu huella es relativamente alta. Es un buen momento para considerar cambios significativos en tu estilo de vida.",
                tip1: "Reduce drásticamente el consumo de carne roja y lácteos.", tip2: "Prioriza el transporte público, bicicleta o caminar. Considera un vehículo eléctrico si necesitas coche.", tip3: "Mejora la eficiencia energética: aislamiento, LEDs, termostatos inteligentes, electrodomésticos A+++.", tip4: "Adopta el 'Reducir, Reutilizar, Reciclar'. Compra menos, elige segunda mano, repara.", tip5: "Minimiza los viajes en avión, especialmente los cortos. Compensa las emisiones cuando vueles.", tip6: "Apoya las energías renovables, ya sea contratando tarifas verdes o instalando paneles solares.", tip7: "Composta tus residuos orgánicos.", tip8: "Consume productos locales y de temporada para reducir la huella del transporte de alimentos.", tip9: "Ahorra agua en casa.", tip10:"Considera el impacto del tamaño de tu hogar y busca formas de compartir recursos."
            },
            en: {
                selectLanguage: "Select Language:",
                title: "Carbon Footprint Calculator",
                subtitle: "Discover your environmental impact by answering a few simple questions.",
                prevButton: "Previous",
                nextButton: "Next",
                submitButton: "Calculate Footprint",
                resultTitle: "Your Estimated Carbon Footprint",
                resultUnit: "tonnes CO2e/year",
                resultInfoDefault: "Complete the questionnaire to see your result.",
                tipsTitle: "Tips to Reduce Your Footprint:",
                restartButton: "Start Over",
                question: "Question",
                footer_text: "Made by Luis Marcelo Medina for a school project at Liceo Campo Verde", // Added footer text EN
                // Questions & Options (Q1-Q14 - English placeholders) ... [Kept for brevity]
                q1_title: "Question 1: Diet - Red Meat", q1_text: "How often do you eat red meat (beef, pork, lamb)?", q1_opt1: "Almost every day", q1_opt2: "Several times a week", q1_opt3: "Rarely or never",
                q2_title: "Question 2: Main Transport", q2_text: "What is your primary mode of transport for long distances (>15km)?", q2_opt1: "Car (gasoline/diesel)", q2_opt2: "Public transport", q2_opt3: "Electric/Hybrid car", q2_opt4: "Bicycle/Walking/None",
                q3_title: "Question 3: Home Energy Efficiency", q3_text: "How energy efficient is your home?", q3_opt1: "Not very efficient", q3_opt2: "Moderately efficient", q3_opt3: "Very efficient",
                q4_title: "Question 4: Consumption & Waste", q4_text: "Do you buy new items and recycle?", q4_opt1: "Buy often, recycle little", q4_opt2: "Buy occasionally, recycle regularly", q4_opt3: "Buy rarely, recycle a lot",
                q5_title: "Question 5: Air Travel (Short)", q5_text: "How many short-haul flights (under 3 hours) per year?", q5_opt1: "None", q5_opt2: "1-2 flights", q5_opt3: "3-5 flights", q5_opt4: "More than 5",
                q6_title: "Question 6: Air Travel (Long)", q6_text: "How many long-haul flights (over 3 hours) per year?", q6_opt1: "None", q6_opt2: "1-2 flights", q6_opt3: "3-4 flights", q6_opt4: "More than 4",
                q7_title: "Question 7: Household Size", q7_text: "How many people live in your household?", q7_opt1: "Live alone", q7_opt2: "2 people", q7_opt3: "3-4 people", q7_opt4: "5 or more",
                q8_title: "Question 8: Housing Type", q8_text: "What type of housing?", q8_opt1: "Large detached house", q8_opt2: "Semi-detached/Duplex", q8_opt3: "Apartment/Flat",
                q9_title: "Question 9: Primary Energy Source", q9_text: "Main energy source for heating/cooking?", q9_opt1: "Coal/Wood/Oil", q9_opt2: "Natural gas/LPG", q9_opt3: "Standard electricity", q9_opt4: "Renewable electricity/None",
                q10_title: "Question 10: Organic Waste", q10_text: "What about organic waste?", q10_opt1: "General waste", q10_opt2: "Compost/Collection", q10_opt3: "Almost none",
                q11_title: "Question 11: Water Consumption", q11_text: "Are you conscious of water use?", q11_opt1: "Not really", q11_opt2: "Sometimes", q11_opt3: "Yes, actively",
                q12_title: "Question 12: Secondary Transport", q12_text: "Use car for short trips (<5km)?", q12_opt1: "Yes, almost always", q12_opt2: "Sometimes", q12_opt3: "No, prefer walk/bike/transit",
                q13_title: "Question 13: Local & Seasonal Food", q13_text: "Buy local/seasonal food often?", q13_opt1: "Rarely", q13_opt2: "Occasionally", q13_opt3: "Frequently",
                q14_title: "Question 14: Diet - Dairy & Poultry", q14_text: "Dairy and poultry consumption?", q14_opt1: "High daily", q14_opt2: "Moderate", q14_opt3: "Low or none",
                // Result Messages & Tips (English Placeholders) ... [Kept for brevity]
                result_low: "Your footprint is relatively low. Excellent work!", result_medium: "Your footprint is average. Room for improvement.", result_high: "Your footprint is relatively high. Consider significant changes.",
                tip1: "Reduce red meat and dairy.", tip2: "Use sustainable transport.", tip3: "Improve home energy efficiency.", tip4: "Reduce, Reuse, Recycle.", tip5: "Minimize air travel.", tip6: "Support renewables.", tip7: "Compost organic waste.", tip8: "Eat local/seasonal.", tip9: "Save water.", tip10:"Consider household size impact."
            },
            fr: {
                selectLanguage: "Choisir la langue:",
                title: "Calculateur d'Empreinte Carbone",
                subtitle: "Découvrez votre impact environnemental.",
                prevButton: "Précédent",
                nextButton: "Suivant",
                submitButton: "Calculer",
                resultTitle: "Votre Empreinte Carbone Estimée",
                resultUnit: "tonnes CO2e/an",
                resultInfoDefault: "Complétez le questionnaire.",
                tipsTitle: "Conseils pour Réduire:",
                restartButton: "Recommencer",
                question: "Question",
                footer_text: "Réalisé par Luis Marcelo Medina pour un projet scolaire du Liceo Campo Verde", // Added footer text FR
                 // Questions & Options (Q1-Q14 - French placeholders) ... [Kept for brevity]
                 q1_title: "Question 1 : Viande Rouge", q1_text: "Fréquence de consommation de viande rouge ?", q1_opt1: "Presque tous les jours", q1_opt2: "Plusieurs fois/semaine", q1_opt3: "Rarement/jamais",
                 q2_title: "Question 2 : Transport Principal", q2_text: "Transport principal pour longues distances (>15km) ?", q2_opt1: "Voiture (essence/diesel)", q2_opt2: "Transport public", q2_opt3: "Voiture élec./hybride", q2_opt4: "Vélo/Marche/Aucun",
                 q3_title: "Question 3 : Efficacité Énergétique", q3_text: "Efficacité énergétique du logement ?", q3_opt1: "Peu efficace", q3_opt2: "Modérément", q3_opt3: "Très efficace",
                 q4_title: "Question 4 : Consommation/Déchets", q4_text: "Achat d'articles neufs et recyclage ?", q4_opt1: "Achète souvent, recycle peu", q4_opt2: "Achète occas., recycle rég.", q4_opt3: "Achète rarement, recycle bcp",
                 q5_title: "Question 5 : Vols Courts", q5_text: "Combien de vols courts (<3h) par an ?", q5_opt1: "Aucun", q5_opt2: "1-2 vols", q5_opt3: "3-5 vols", q5_opt4: "Plus de 5",
                 q6_title: "Question 6 : Vols Longs", q6_text: "Combien de vols longs (>3h) par an ?", q6_opt1: "Aucun", q6_opt2: "1-2 vols", q6_opt3: "3-4 vols", q6_opt4: "Plus de 4",
                 q7_title: "Question 7 : Taille Foyer", q7_text: "Combien de personnes dans le foyer ?", q7_opt1: "Vis seul(e)", q7_opt2: "2 personnes", q7_opt3: "3-4 personnes", q7_opt4: "5 ou plus",
                 q8_title: "Question 8 : Type Logement", q8_text: "Type de logement principal ?", q8_opt1: "Grande maison indiv.", q8_opt2: "Maison mitoyenne/Duplex", q8_opt3: "Appartement",
                 q9_title: "Question 9 : Source Énergie", q9_text: "Source énergie principale (chauffage/cuisine) ?", q9_opt1: "Charbon/Bois/Fioul", q9_opt2: "Gaz naturel/GPL", q9_opt3: "Électricité standard", q9_opt4: "Électricité renouvelable/Aucun",
                 q10_title: "Question 10 : Déchets Organiques", q10_text: "Que faites-vous des déchets organiques ?", q10_opt1: "Ordures ménagères", q10_opt2: "Compost/Collecte", q10_opt3: "Presque aucun",
                 q11_title: "Question 11 : Consommation Eau", q11_text: "Conscient de la consommation d'eau ?", q11_opt1: "Pas vraiment", q11_opt2: "Parfois", q11_opt3: "Oui, activement",
                 q12_title: "Question 12 : Transport Secondaire", q12_text: "Voiture pour courts trajets (<5km) ?", q12_opt1: "Oui, presque toujours", q12_opt2: "Parfois", q12_opt3: "Non (marche/vélo/transit)",
                 q13_title: "Question 13 : Achats Locaux/Saison", q13_text: "Achetez-vous local/saison souvent ?", q13_opt1: "Rarement", q13_opt2: "Occasionnellement", q13_opt3: "Fréquemment",
                 q14_title: "Question 14 : Laitages/Volaille", q14_text: "Consommation de laitage et volaille ?", q14_opt1: "Élevée quotidienne", q14_opt2: "Modérée", q14_opt3: "Faible ou nulle",
                // Result Messages & Tips (French Placeholders) ... [Kept for brevity]
                result_low: "Votre empreinte est faible. Excellent !", result_medium: "Votre empreinte est moyenne. Améliorations possibles.", result_high: "Votre empreinte est élevée. Changements importants suggérés.",
                tip1: "Réduire viande rouge/laitages.", tip2: "Transport durable.", tip3: "Efficacité énergétique maison.", tip4: "Réduire, Réutiliser, Recycler.", tip5: "Minimiser vols.", tip6: "Soutenir renouvelables.", tip7: "Composter déchets org.", tip8: "Manger local/saison.", tip9: "Économiser l'eau.", tip10:"Considérer taille foyer."
            }
        };

        // --- Calculator Logic ---
        const questions = [ // [Same questions array as previous version - kept for brevity]
             { id: 'q1', weight: 1.5, options: [ { value: 3, text_key: 'q1_opt1' }, { value: 2, text_key: 'q1_opt2' }, { value: 1, text_key: 'q1_opt3' } ], title_key: 'q1_title', text_key: 'q1_text' },
            { id: 'q2', weight: 1.8, options: [ { value: 4, text_key: 'q2_opt1' }, { value: 2, text_key: 'q2_opt2' }, { value: 1, text_key: 'q2_opt3' }, { value: 0, text_key: 'q2_opt4' } ], title_key: 'q2_title', text_key: 'q2_text' },
            { id: 'q3', weight: 1.2, options: [ { value: 3, text_key: 'q3_opt1' }, { value: 2, text_key: 'q3_opt2' }, { value: 1, text_key: 'q3_opt3' } ], title_key: 'q3_title', text_key: 'q3_text' },
            { id: 'q4', weight: 1.0, options: [ { value: 3, text_key: 'q4_opt1' }, { value: 2, text_key: 'q4_opt2' }, { value: 1, text_key: 'q4_opt3' } ], title_key: 'q4_title', text_key: 'q4_text' },
            { id: 'q5', weight: 2.5, options: [ { value: 0, text_key: 'q5_opt1' }, { value: 2, text_key: 'q5_opt2' }, { value: 4, text_key: 'q5_opt3' }, { value: 6, text_key: 'q5_opt4' } ], title_key: 'q5_title', text_key: 'q5_text' },
            { id: 'q6', weight: 3.0, options: [ { value: 0, text_key: 'q6_opt1' }, { value: 3, text_key: 'q6_opt2' }, { value: 6, text_key: 'q6_opt3' }, { value: 9, text_key: 'q6_opt4' } ], title_key: 'q6_title', text_key: 'q6_text' },
            { id: 'q7', weight: 0.8, options: [ { value: 3, text_key: 'q7_opt1' }, { value: 2, text_key: 'q7_opt2' }, { value: 1, text_key: 'q7_opt3' }, { value: 0.5, text_key: 'q7_opt4' } ], title_key: 'q7_title', text_key: 'q7_text' },
            { id: 'q8', weight: 0.7, options: [ { value: 3, text_key: 'q8_opt1' }, { value: 2, text_key: 'q8_opt2' }, { value: 1, text_key: 'q8_opt3' } ], title_key: 'q8_title', text_key: 'q8_text' },
            { id: 'q9', weight: 1.4, options: [ { value: 4, text_key: 'q9_opt1' }, { value: 3, text_key: 'q9_opt2' }, { value: 2, text_key: 'q9_opt3' }, { value: 1, text_key: 'q9_opt4' } ], title_key: 'q9_title', text_key: 'q9_text' },
            { id: 'q10', weight: 0.6, options: [ { value: 2, text_key: 'q10_opt1' }, { value: 0, text_key: 'q10_opt2' }, { value: 0, text_key: 'q10_opt3' } ], title_key: 'q10_title', text_key: 'q10_text' },
            { id: 'q11', weight: 0.5, options: [ { value: 2, text_key: 'q11_opt1' }, { value: 1, text_key: 'q11_opt2' }, { value: 0, text_key: 'q11_opt3' } ], title_key: 'q11_title', text_key: 'q11_text' },
            { id: 'q12', weight: 0.9, options: [ { value: 3, text_key: 'q12_opt1' }, { value: 1.5, text_key: 'q12_opt2' }, { value: 0, text_key: 'q12_opt3' } ], title_key: 'q12_title', text_key: 'q12_text' },
            { id: 'q13', weight: 0.4, options: [ { value: 2, text_key: 'q13_opt1' }, { value: 1, text_key: 'q13_opt2' }, { value: 0, text_key: 'q13_opt3' } ], title_key: 'q13_title', text_key: 'q13_text' },
            { id: 'q14', weight: 1.0, options: [ { value: 2, text_key: 'q14_opt1' }, { value: 1, text_key: 'q14_opt2' }, { value: 0.5, text_key: 'q14_opt3' } ], title_key: 'q14_title', text_key: 'q14_text' }
        ];

        let currentQuestionIndex = 0;
        let currentLang = 'es';
        const answers = {};
        const totalQuestions = questions.length;

        // --- DOM Elements ---
        const langSelect = document.getElementById('lang-select');
        const questionsContainer = document.getElementById('questions-container');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const submitBtn = document.getElementById('submit-btn');
        const resultSection = document.getElementById('result');
        const scoreDisplay = document.getElementById('score');
        const resultMessage = document.getElementById('result-message');
        const tipsList = document.getElementById('tips-list');
        const navigationDiv = document.getElementById('navigation');
        const form = document.getElementById('carbon-form');
        const restartBtn = document.getElementById('restart-btn');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');


        // --- Functions ---

        // Function to update text based on selected language
        function updateLanguage(lang) {
            currentLang = lang;
            document.documentElement.lang = lang; // Update html lang attribute
            const elements = document.querySelectorAll('[data-translate]');
            elements.forEach(el => {
                const key = el.getAttribute('data-translate');
                // Use provided language, fallback to English, then fallback to the key itself
                const translation = translations[lang]?.[key] ?? translations['en']?.[key] ?? key;

                // Handle specific elements like inputs or use textContent
                if (el.tagName === 'INPUT' && (el.type === 'submit' || el.type === 'button')) {
                    if(el.type === 'button' || el.type === 'submit') el.textContent = translation;
                } else if (el.tagName === 'SELECT') {
                    const label = document.querySelector(`label[for="${el.id}"]`);
                    if(label) label.textContent = translation;
                } else if (el.tagName === 'SPAN' && el.parentElement.id === 'progress-text') {
                     // Handle the "Question" span in progress text
                     el.textContent = translation; // Update only the span part
                }
                else {
                    el.textContent = translation;
                }
            });

            // Update progress text structure separately if needed
             updateProgressIndicator(); // Ensure the full progress text is updated

            // Re-render the current question to update its text
            renderQuestion(currentQuestionIndex);
            // Update result text if visible
             if (!resultSection.classList.contains('hidden')) {
                updateResultText();
            }
        }

         // Function to update progress bar and text
        function updateProgressIndicator() {
            const progressPercentage = ((currentQuestionIndex + 1) / totalQuestions) * 100;
            progressBar.style.width = `${progressPercentage}%`;
            // Ensure the "Question" part is translatable using the fallback logic
            const questionWord = translations[currentLang]?.['question'] ?? translations['en']?.['question'] ?? 'Question';
            progressText.innerHTML = `<span data-translate="question">${questionWord}</span> ${currentQuestionIndex + 1} / ${totalQuestions}`;
        }


        // Function to render a specific question
        function renderQuestion(index) {
            questionsContainer.innerHTML = ''; // Clear previous question
            if (index < 0 || index >= totalQuestions) return; // Safety check

            const q = questions[index];
            const questionCard = document.createElement('div');
            questionCard.className = 'question-card animate-fade-in'; // Add animation class
            questionCard.setAttribute('data-question-index', index);

            const title = document.createElement('h2');
            title.className = 'text-lg font-semibold mb-2 text-gray-700';
            title.setAttribute('data-translate', q.title_key);
            title.textContent = translations[currentLang]?.[q.title_key] ?? translations['en']?.[q.title_key] ?? q.title_key; // Fallback logic

            const text = document.createElement('p');
            text.className = 'mb-4 text-gray-600';
            text.setAttribute('data-translate', q.text_key);
            text.textContent = translations[currentLang]?.[q.text_key] ?? translations['en']?.[q.text_key] ?? q.text_key; // Fallback logic

            const optionsDiv = document.createElement('div');
            optionsDiv.className = 'options space-y-2'; // Add spacing between options

            q.options.forEach((opt, i) => {
                const optionId = `${q.id}_opt${i}`;
                const radioInput = document.createElement('input');
                radioInput.type = 'radio';
                radioInput.id = optionId;
                radioInput.name = q.id;
                radioInput.value = opt.value;
                radioInput.className = 'hidden'; // Hide radio button

                const label = document.createElement('label');
                label.htmlFor = optionId;
                label.className = 'option-label';
                label.setAttribute('data-translate', opt.text_key);
                label.textContent = translations[currentLang]?.[opt.text_key] ?? translations['en']?.[opt.text_key] ?? opt.text_key; // Fallback logic

                 // Add event listener to store answer immediately on change
                radioInput.addEventListener('change', (event) => {
                    answers[q.id] = parseFloat(event.target.value); // Store answer as number

                    // Re-apply selected style immediately
                    const allLabels = optionsDiv.querySelectorAll('.option-label');
                    allLabels.forEach(lbl => {
                         lbl.classList.remove('bg-blue-100', 'border-blue-500', 'font-medium');
                    });
                    label.classList.add('bg-blue-100', 'border-blue-500', 'font-medium'); // Re-add selected style using Tailwind classes


                     // Automatically move to next question if not the last one
                    if (currentQuestionIndex < totalQuestions - 1) {
                       setTimeout(() => showQuestion(currentQuestionIndex + 1), 200); // Small delay
                    } else {
                        // Enable submit button if last question is answered
                         submitBtn.disabled = false;
                    }
                });

                optionsDiv.appendChild(radioInput);
                optionsDiv.appendChild(label);

                 // Check if this option was previously selected and apply style
                if (answers[q.id] !== undefined && answers[q.id] == opt.value) { // Use == for potential type coercion
                    radioInput.checked = true;
                    label.classList.add('bg-blue-100', 'border-blue-500', 'font-medium');
                }

            });

            questionCard.appendChild(title);
            questionCard.appendChild(text);
            questionCard.appendChild(optionsDiv);
            questionsContainer.appendChild(questionCard);

            // Update button visibility and state
            updateNavigationButtons();
            // Update progress bar
            updateProgressIndicator();
        }

        // Function to show a specific question index
        function showQuestion(index) {
            if (index >= 0 && index < totalQuestions) {
                currentQuestionIndex = index;
                renderQuestion(currentQuestionIndex);
            }
        }

        // Function to update navigation buttons visibility/state
        function updateNavigationButtons() {
            navigationDiv.classList.remove('hidden'); // Show navigation container
            prevBtn.classList.toggle('hidden', currentQuestionIndex === 0);
            nextBtn.classList.toggle('hidden', currentQuestionIndex === totalQuestions - 1);
            submitBtn.classList.toggle('hidden', currentQuestionIndex !== totalQuestions - 1);
             // Disable submit button initially on the last question until an option is selected
            submitBtn.disabled = (currentQuestionIndex === totalQuestions - 1 && answers[questions[currentQuestionIndex].id] === undefined);
        }

        // Function to calculate the footprint
        function calculateFootprint() {
            let totalScore = 0;
            const baseFootprint = 1.5; // Base footprint assumption

            questions.forEach(q => {
                const answerValue = answers[q.id];
                if (answerValue !== undefined) {
                    totalScore += answerValue * q.weight;
                } else {
                    console.warn(`No answer found for question ${q.id}. Skipping in calculation.`);
                }
            });

            // Calculate the theoretical maximum score
            let maxScore = 0;
            questions.forEach(q => {
                let maxOptionValue = 0;
                q.options.forEach(opt => {
                    if (opt.value > maxOptionValue) {
                        maxOptionValue = opt.value;
                    }
                });
                maxScore += maxOptionValue * q.weight;
            });

            const minFootprint = baseFootprint;
            const maxFootprint = 25.0; // Adjusted max potential footprint

            if (maxScore === 0) return baseFootprint.toFixed(1); // Avoid division by zero

            const cappedScore = Math.min(totalScore, maxScore);
            const calculatedFootprint = minFootprint + (cappedScore / maxScore) * (maxFootprint - minFootprint);

            return calculatedFootprint.toFixed(1);
        }

         // Function to update result text based on score and language
        function updateResultText(score = null) {
            const lang = currentLang;
            if (score === null) {
                score = parseFloat(scoreDisplay.textContent) || 0;
            }

            let messageKey = 'resultInfoDefault';
            let allTipsKeys = ['tip1', 'tip2', 'tip3', 'tip4', 'tip5', 'tip6', 'tip7', 'tip8', 'tip9', 'tip10'];
            let tipsKeys = [];

            if (score > 0) {
                if (score <= 8.0) { messageKey = 'result_low'; tipsKeys = ['tip2', 'tip4', 'tip6', 'tip8']; }
                else if (score <= 16.0) { messageKey = 'result_medium'; tipsKeys = ['tip1', 'tip3', 'tip5', 'tip7', 'tip9']; }
                else { messageKey = 'result_high'; tipsKeys = ['tip1', 'tip3', 'tip5', 'tip7', 'tip10']; }
                if (tipsKeys.length < 4 && !tipsKeys.includes('tip4')) { tipsKeys.push('tip4'); }
            } else {
                 tipsKeys = allTipsKeys.slice(0, 5);
            }

            // Use fallback logic for all translatable elements in results
            resultMessage.textContent = translations[lang]?.[messageKey] ?? translations['en']?.[messageKey] ?? messageKey;
            resultMessage.setAttribute('data-translate', messageKey);

            tipsList.innerHTML = '';
            tipsKeys.forEach(tipKey => {
                 const tipText = translations[lang]?.[tipKey] ?? translations['en']?.[tipKey] ?? tipKey;
                 if (tipText) {
                    const li = document.createElement('li');
                    li.setAttribute('data-translate', tipKey);
                    li.textContent = tipText;
                    tipsList.appendChild(li);
                 }
            });

            document.querySelector('#result h2').textContent = translations[lang]?.resultTitle ?? translations['en']?.resultTitle ?? 'Result';
            document.querySelector('#result h2').setAttribute('data-translate', 'resultTitle');
            document.querySelector('#result .text-3xl span[data-translate="resultUnit"]').textContent = translations[lang]?.resultUnit ?? translations['en']?.resultUnit ?? 'units';
            document.querySelector('#result .text-3xl span[data-translate="resultUnit"]').setAttribute('data-translate', 'resultUnit');
            document.querySelector('#result h3').textContent = translations[lang]?.tipsTitle ?? translations['en']?.tipsTitle ?? 'Tips';
            document.querySelector('#result h3').setAttribute('data-translate', 'tipsTitle');
            restartBtn.textContent = translations[lang]?.restartButton ?? translations['en']?.restartButton ?? 'Restart';
            restartBtn.setAttribute('data-translate', 'restartButton');
        }


        // --- Event Listeners ---
        langSelect.addEventListener('change', (e) => {
            updateLanguage(e.target.value);
        });

        prevBtn.addEventListener('click', () => {
            showQuestion(currentQuestionIndex - 1);
        });

        nextBtn.addEventListener('click', () => {
             const currentQId = questions[currentQuestionIndex].id;
             if (answers[currentQId] === undefined) {
                 const card = questionsContainer.querySelector('.question-card');
                 if (card) {
                     card.style.animation = 'shake 0.5s ease-in-out';
                     setTimeout(() => card.style.animation = '', 500);
                 }
                 console.warn("Please select an option before proceeding.");
                 return;
             }
            showQuestion(currentQuestionIndex + 1);
        });

        form.addEventListener('submit', (e) => {
            e.preventDefault();
             const lastQId = questions[totalQuestions - 1].id;
             if (answers[lastQId] === undefined) {
                 console.error("Cannot submit, last question not answered.");
                 const card = questionsContainer.querySelector('.question-card');
                 if (card) {
                     card.style.animation = 'shake 0.5s ease-in-out';
                     setTimeout(() => card.style.animation = '', 500);
                 }
                 return;
             }

            const finalScore = calculateFootprint();
            scoreDisplay.textContent = finalScore;
            updateResultText(parseFloat(finalScore));

            form.classList.add('hidden');
            navigationDiv.classList.add('hidden');
            document.querySelector('.progress-bar-container').classList.add('hidden');
            progressText.classList.add('hidden');
            resultSection.classList.remove('hidden');
        });

        restartBtn.addEventListener('click', () => {
            currentQuestionIndex = 0;
            Object.keys(answers).forEach(key => delete answers[key]);

            resultSection.classList.add('hidden');
            form.classList.remove('hidden');
            navigationDiv.classList.remove('hidden');
            document.querySelector('.progress-bar-container').classList.remove('hidden');
            progressText.classList.remove('hidden');

            scoreDisplay.textContent = '0';
            updateResultText(); // Reset result text to default based on current language
            showQuestion(0);
        });


        // --- Initial Setup ---
        updateLanguage(langSelect.value); // Set initial language based on dropdown default

    </script>

    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
         @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
    </style>

</body>
</html>
